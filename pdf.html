<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium PDF Analiz Sistemi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<style>
    :root {
    --primary-color: #6a11cb;
    --secondary-color: #2575fc;
    --accent-color: #ff8a00;
    --light-color: #f8f9fa;
    --dark-color: #343a40;
    --success-color: #28a745;
    --warning-color: #ffc107;
    --danger-color: #dc3545;
    --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    color: var(--dark-color);
}

.premium-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.premium-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 20px;
    background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
    color: white;
    border-radius: 10px;
    box-shadow: var(--shadow);
}

.premium-header h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.premium-header p {
    font-size: 1.1rem;
    opacity: 0.9;
}

.main-content {
    display: flex;
    flex-direction: column;
    gap: 30px;
}

.upload-section {
    background-color: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: var(--shadow);
    text-align: center;
}

.dropzone {
    border: 3px dashed #ddd;
    border-radius: 8px;
    padding: 40px;
    cursor: pointer;
    transition: all 0.3s;
}

.dropzone:hover {
    border-color: var(--primary-color);
    background-color: rgba(106, 17, 203, 0.05);
}

.dropzone i {
    color: var(--primary-color);
    margin-bottom: 15px;
}

.dropzone p {
    font-size: 1.1rem;
    color: var(--dark-color);
    margin-bottom: 15px;
}

#fileInput {
    display: none;
}

.progress-container {
    margin-top: 20px;
    display: none;
}

.progress-bar {
    height: 10px;
    background-color: #e9ecef;
    border-radius: 5px;
    overflow: hidden;
    margin-bottom: 5px;
}

.progress-bar div {
    height: 100%;
    background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
    width: 0%;
    transition: width 0.3s;
}

.analysis-section, .qa-section {
    background-color: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: var(--shadow);
    display: none;
}

.stats-container {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    gap: 20px;
    margin: 30px 0;
}

.stat-box {
    flex: 1;
    min-width: 150px;
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #f6f7f9 0%, #e9ebee 100%);
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: bold;
    background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    display: block;
    line-height: 1;
}

.stat-label {
    font-size: 1rem;
    color: var(--dark-color);
    opacity: 0.7;
}

.summary-box {
    background-color: #f8f9fa;
    border-left: 4px solid var(--primary-color);
    padding: 20px;
    border-radius: 0 8px 8px 0;
    margin-top: 20px;
}

.chat-container {
    margin-top: 20px;
    border: 1px solid #eee;
    border-radius: 8px;
    overflow: hidden;
}

.chat-messages {
    height: 400px;
    overflow-y: auto;
    padding: 20px;
    background-color: #f9f9f9;
}

.message {
    margin-bottom: 15px;
    padding: 12px 15px;
    border-radius: 8px;
    max-width: 80%;
    word-wrap: break-word;
}

.user-message {
    background-color: var(--primary-color);
    color: white;
    margin-left: auto;
    border-bottom-right-radius: 2px;
}

.bot-message {
    background-color: white;
    border: 1px solid #eee;
    margin-right: auto;
    border-bottom-left-radius: 2px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.citation {
    font-size: 0.8rem;
    color: #666;
    margin-top: 5px;
    font-style: italic;
}

.chat-input {
    display: flex;
    padding: 15px;
    background-color: white;
    border-top: 1px solid #eee;
}

#questionInput {
    flex: 1;
    padding: 12px 15px;
    border: 1px solid #ddd;
    border-radius: 4px 0 0 4px;
    font-size: 1rem;
    outline: none;
}

#questionInput:focus {
    border-color: var(--primary-color);
}

#askButton {
    padding: 12px 20px;
    background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
    color: white;
    border: none;
    border-radius: 0 4px 4px 0;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.3s;
}

#askButton:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

.premium-footer {
    text-align: center;
    margin-top: 40px;
    padding: 20px;
    color: var(--dark-color);
    opacity: 0.7;
    font-size: 0.9rem;
}

@media (max-width: 768px) {
    .premium-header h1 {
        font-size: 2rem;
    }
    
    .stats-container {
        flex-direction: column;
    }
    
    .stat-box {
        min-width: 100%;
    }
}
/* Premium rejim üçün üslublar */
.premium-toggle {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
  color: #6a11cb;
  font-weight: bold;
}

.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 24px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: #6a11cb;
}

input:checked + .slider:before {
  transform: translateX(26px);
}

/* Cavab üslubları */
.message.premium {
  border-left: 4px solid #6a11cb;
  background: rgba(106, 17, 203, 0.05);
}

.correct-answer, .explanation, .citation {
  margin-top: 10px;
  padding: 8px 12px;
  border-radius: 4px;
  font-size: 0.9em;
}

.correct-answer {
  background: rgba(40, 167, 69, 0.1);
  border-left: 3px solid #28a745;
}

.explanation {
  background: rgba(255, 193, 7, 0.1);
  border-left: 3px solid #ffc107;
}

.citation {
  background: rgba(13, 110, 253, 0.1);
  border-left: 3px solid #0d6efd;
}

.premium-badge {
  display: inline-block;
  margin-top: 8px;
  padding: 4px 8px;
  background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
  color: white;
  border-radius: 12px;
  font-size: 0.8em;
}
</style>
<body>
    <div class="premium-container">
        <header class="premium-header">
            <h1><i class="fas fa-crown"></i> Premium PDF Analiz Sistemi</h1>
            <h2>Lahiyyə Ağayev Sadiq tərəfindən hazırlanmışdır</h2>
            <p>PDF fayllarınızı dəqiq analiz edib, ağıllı sual-cavab xidməti təqdim edirik</p>
        </header>

        <div class="main-content">
            <div class="upload-section">
                <div class="dropzone" id="dropzone">
                    <i class="fas fa-file-pdf fa-3x"></i>
                    <p>PDF faylınızı buraya sürükləyin və ya klik edib seçin</p>
                    <input type="file" id="fileInput" accept=".pdf">
                </div>
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                    <span id="progressText">0%</span>
                </div>
            </div>

            <div class="analysis-section" id="analysisSection">
                <h2><i class="fas fa-chart-bar"></i> PDF Analiz Nəticələri</h2>
                <div class="stats-container">
                    <div class="stat-box">
                        <span class="stat-value" id="pageCount">0</span>
                        <span class="stat-label">Səhifə</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value" id="wordCount">0</span>
                        <span class="stat-label">Söz</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value" id="sectionCount">0</span>
                        <span class="stat-label">Bölmə</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value" id="keywordCount">0</span>
                        <span class="stat-label">Açar Söz</span>
                    </div>
                </div>
                <div class="summary-box" id="summaryBox"></div>
            </div>

            <div class="qa-section" id="qaSection">
                <h2><i class="fas fa-question-circle"></i> Sual-Cavab</h2>
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="chat-input">
                        <input type="text" id="questionInput" placeholder="PDF ilə bağlı sualınızı yazın...">
                        <button id="askButton"><i class="fas fa-paper-plane"></i> Göndər</button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="premium-footer">
            <p>© 2023 Premium PDF Analiz Sistemi | Bütün hüquqlar qorunur</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script >
        // PDF.js worker path
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

// Global variables
let pdfDocument = null;
let pdfText = "";
let pdfMetadata = {
    pages: 0,
    words: 0,
    sections: 0,
    keywords: []
};

// DOM elements
const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const progressContainer = document.getElementById('progressContainer');
const progressBar = document.getElementById('progressBar');
const progressText = document.getElementById('progressText');
const analysisSection = document.getElementById('analysisSection');
const qaSection = document.getElementById('qaSection');
const pageCount = document.getElementById('pageCount');
const wordCount = document.getElementById('wordCount');
const sectionCount = document.getElementById('sectionCount');
const keywordCount = document.getElementById('keywordCount');
const summaryBox = document.getElementById('summaryBox');
const chatMessages = document.getElementById('chatMessages');
const questionInput = document.getElementById('questionInput');
const askButton = document.getElementById('askButton');

// Event listeners
dropzone.addEventListener('click', () => fileInput.click());
dropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.style.borderColor = '#6a11cb';
    dropzone.style.backgroundColor = 'rgba(106, 17, 203, 0.1)';
});
dropzone.addEventListener('dragleave', () => {
    dropzone.style.borderColor = '#ddd';
    dropzone.style.backgroundColor = 'rgba(106, 17, 203, 0.05)';
});
dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.style.borderColor = '#ddd';
    dropzone.style.backgroundColor = 'rgba(106, 17, 203, 0.05)';
    
    if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        handleFileUpload(e.dataTransfer.files[0]);
    }
});

fileInput.addEventListener('change', () => {
    if (fileInput.files.length) {
        handleFileUpload(fileInput.files[0]);
    }
});

askButton.addEventListener('click', askQuestion);
questionInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        askQuestion();
    }
});

// Handle PDF file upload
async function handleFileUpload(file) {
    if (file.type !== 'application/pdf') {
        alert('Zəhmət olmasa PDF faylı yükləyin');
        return;
    }

    // Show progress
    dropzone.innerHTML = `<i class="fas fa-spinner fa-spin fa-3x"></i><p>${file.name} yüklənir...</p>`;
    progressContainer.style.display = 'block';

    try {
        const fileReader = new FileReader();
        
        fileReader.onprogress = (e) => {
            if (e.lengthComputable) {
                const percentLoaded = Math.round((e.loaded / e.total) * 100);
                progressBar.style.width = `${percentLoaded}%`;
                progressText.textContent = `${percentLoaded}%`;
            }
        };

        fileReader.onload = async (e) => {
            const typedArray = new Uint8Array(e.target.result);
            await loadPdf(typedArray);
        };

        fileReader.readAsArrayBuffer(file);
    } catch (error) {
        console.error('PDF yüklənmə xətası:', error);
        alert('PDF yüklənərkən xəta baş verdi');
        resetUI();
    }
}

// Load and parse PDF
async function loadPdf(data) {
    try {
        // Load the PDF
        const loadingTask = pdfjsLib.getDocument(data);
        pdfDocument = await loadingTask.promise;
        
        // Extract text from all pages
        pdfText = "";
        pdfMetadata.pages = pdfDocument.numPages;
        
        for (let i = 1; i <= pdfDocument.numPages; i++) {
            const page = await pdfDocument.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');
            pdfText += pageText + "\n\n";
            
            // Update progress
            const percentComplete = Math.round((i / pdfDocument.numPages) * 100);
            progressBar.style.width = `${percentComplete}%`;
            progressText.textContent = `${percentComplete}%`;
        }
        
        // Analyze the text
        analyzePdfText();
        
        // Update UI
        progressContainer.style.display = 'none';
        dropzone.innerHTML = `
            <i class="fas fa-check-circle fa-3x" style="color: #28a745"></i>
            <p>PDF uğurla yükləndi!</p>
            <p class="small">${pdfMetadata.pages} səhifə, ${pdfMetadata.words} söz</p>
        `;
        
        // Show analysis and QA sections
        analysisSection.style.display = 'block';
        qaSection.style.display = 'block';
        
        // Add a welcome message to the chat
        addBotMessage("PDF uğurla yükləndi! İndi sənə bu sənəd haqqında suallar verə bilərəm. Nə soruşmaq istəyirsən?");
    } catch (error) {
        console.error('PDF oxuma xətası:', error);
        alert('PDF oxunarkən xəta baş verdi');
        resetUI();
    }
}

// Analyze the extracted PDF text
function analyzePdfText() {
    // Basic statistics
    pdfMetadata.words = pdfText.split(/\s+/).filter(word => word.length > 0).length;
    
    // Detect sections (assuming headings are in all caps or followed by colons)
    const sectionMatches = pdfText.match(/\n[A-Z][A-Z\s]+\n|^[A-Z][A-Z\s]+\n|\n.+\:\n/g);
    pdfMetadata.sections = sectionMatches ? sectionMatches.length : 0;
    
    // Extract keywords (simple approach - most frequent words excluding stop words)
    const words = pdfText.toLowerCase().split(/\s+/);
    const wordCounts = {};
    
    const stopWords = new Set(['the', 'and', 'of', 'to', 'in', 'a', 'is', 'that', 'for', 'it', 'as', 'with', 'on', 'be', 'this', 'by', 'are', 'or']);
    
    words.forEach(word => {
        word = word.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, '');
        if (word.length > 3 && !stopWords.has(word)) {
            wordCounts[word] = (wordCounts[word] || 0) + 1;
        }
    });
    
    // Get top 10 keywords
    pdfMetadata.keywords = Object.entries(wordCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10)
        .map(entry => entry[0]);
    
    // Generate a simple summary (first 200 characters)
    const summary = pdfText.substring(0, 200).replace(/\n/g, ' ') + (pdfText.length > 200 ? '...' : '');
    
    // Update UI with analysis results
    pageCount.textContent = pdfMetadata.pages;
    wordCount.textContent = pdfMetadata.words.toLocaleString();
    sectionCount.textContent = pdfMetadata.sections;
    keywordCount.textContent = pdfMetadata.keywords.length;
    
    summaryBox.innerHTML = `
        <h3><i class="fas fa-file-alt"></i> Xülasə</h3>
        <p>${summary}</p>
        <div class="keywords">
            <h4><i class="fas fa-key"></i> Açar sözlər</h4>
            <div class="keyword-tags">
                ${pdfMetadata.keywords.map(keyword => `<span class="keyword-tag">${keyword}</span>`).join('')}
            </div>
        </div>
    `;
}

// Handle asking a question
function askQuestion() {
    const question = questionInput.value.trim();
    if (!question) return;
    
    // Add user message to chat
    addUserMessage(question);
    questionInput.value = '';
    
    // Show typing indicator
    const typingIndicator = document.createElement('div');
    typingIndicator.className = 'message bot-message typing';
    typingIndicator.innerHTML = '<i class="fas fa-ellipsis-h"></i>';
    chatMessages.appendChild(typingIndicator);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    // Simulate processing delay
    setTimeout(() => {
        // Remove typing indicator
        chatMessages.removeChild(typingIndicator);
        
        // Generate answer (in a real app, this would call an API)
        const answer = generateAnswer(question);
        addBotMessage(answer.text, answer.citation);
    }, 1500);
}

// Generate an answer based on the PDF text (simplified)
function generateAnswer(question) {
    // Convert to lowercase for case-insensitive search
    const lowerQuestion = question.toLowerCase();
    const lowerPdfText = pdfText.toLowerCase();
    
    // Try to find the most relevant sentence
    let bestMatch = "";
    let bestScore = 0;
    let citationPage = 1;
    
    // Split PDF text into sentences
    const sentences = pdfText.split(/[.!?]+/);
    const lowerSentences = lowerPdfText.split(/[.!?]+/);
    
    // Score each sentence based on keyword matches
    for (let i = 0; i < sentences.length; i++) {
        if (!sentences[i].trim()) continue;
        
        const sentence = sentences[i].trim();
        const lowerSentence = lowerSentences[i].trim();
        
        // Simple scoring - count matching words
        const questionWords = lowerQuestion.split(/\s+/);
        const sentenceWords = lowerSentence.split(/\s+/);
        
        let score = 0;
        questionWords.forEach(qWord => {
            if (sentenceWords.includes(qWord)) {
                score++;
            }
        });
        
        // Prefer longer matches with more keywords
        if (score > bestScore || (score === bestScore && sentence.length > bestMatch.length)) {
            bestScore = score;
            bestMatch = sentence;
            
            // Estimate page number (very rough approximation)
            const textPosition = lowerPdfText.indexOf(lowerSentence);
            citationPage = Math.max(1, Math.floor(textPosition / lowerPdfText.length * pdfMetadata.pages));
        }
    }
    
    if (bestMatch) {
        return {
            text: `Sualınıza əsasən: ${bestMatch}`,
            citation: `Səhifə ${citationPage}`
        };
    } else {
        return {
            text: "PDF-də bu sualınıza dəqiq cavab tapa bilmədim. Daha ətraflı və ya fərqli şəkildə soruşmağa çalışa bilərsiniz.",
            citation: ""
        };
    }
}

// Add a user message to the chat
function addUserMessage(text) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message user-message';
    messageDiv.textContent = text;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Add a bot message to the chat
function addBotMessage(text, citation = "") {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message bot-message';
    messageDiv.innerHTML = text;
    
    if (citation) {
        const citationDiv = document.createElement('div');
        citationDiv.className = 'citation';
        citationDiv.innerHTML = `<i class="fas fa-bookmark"></i> ${citation}`;
        messageDiv.appendChild(citationDiv);
    }
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Reset UI
function resetUI() {
    dropzone.innerHTML = `
        <i class="fas fa-file-pdf fa-3x"></i>
        <p>PDF faylınızı buraya sürükləyin və ya klik edib seçin</p>
        <input type="file" id="fileInput" accept=".pdf">
    `;
    progressContainer.style.display = 'none';
    analysisSection.style.display = 'none';
    qaSection.style.display = 'none';
    pdfDocument = null;
    pdfText = "";
    pdfMetadata = {
        pages: 0,
        words: 0,
        sections: 0,
        keywords: []
    };
    chatMessages.innerHTML = '';
}
    </script>
</body>
</html>
